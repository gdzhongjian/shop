<include file="Public/top" />	

<include file="Public/search" />

<include file="Public/banner" />

<link rel="stylesheet" type="text/css" href="__PUBLIC__/index/css/confirm.css"/>
<script type="text/javascript" src="__PUBLIC__/index/layer/layer.js"></script>	
	
		<!--购物车头部开始-->
		<div class="cart_header">	
			<div class="logo_wrap">  
			</div>	
			<div class="status"> 
				<div class="chart"></div> 
				<div class="text"> 
					<span class="first" style="color:#F95285">我的购物车</span> 
					<span class="middle" style="color:#F95285">填写核对订单信息</span> 
					<span>付款，完成购买</span> 
				</div> 
			</div>
		</div>
		<!--购物车头部结束-->
		
		<form action="{:U('order/addorder')}" method="post" id="order_submit">
		<div class="container">	
			<p class="label">确认收货地址</p>	
			<div class="addr">	
				
				<div class="unit adrl_list" id="address_0" style="display: none">
					<input id="curernt_address_0" class="mls-input-radio" type="radio" value="" name="addr"/>
					<label class="mls-input-label mls-input-radio-label" for="curernt_address_0">
						<span class="adrl_addr" id="span_0"></span>
						<span id="span_1"></span>
						<span id="span_2"></span>
					</label>
				</div>

				<volist name="all_address" id="address" key="i">
				<div class="unit adrl_list" id="address_{$i}">
					<input id="curernt_address_{$i}" class="mls-input-radio" type="radio" value="{$address.id}" <if condition='$i eq 1'>checked="checked"</if> name="addr"/>
					<label class="mls-input-label mls-input-radio-label" for="curernt_address_{$i}">
						<span class="adrl_addr">{$address.address}</span>
						<span>{$address.receiver}</span>
						<span>{$address.phone}</span>
					</label>
				</div>
				</volist>


			
				<div class="new_addr" id="new_adder_wrapper">			
					<div class="unit" id="add_new_address">				
						<input value="-1" type="radio" name="addr" id="addr_new" class="mls-input-radio"/>				
						<label style="width:790px" for="addr_new" class="mls-input-label mls-input-radio-label">使用新地址</label>
					</div>	 
					<div class="form" id="addr_form" style="display:none">				
						

						<form id="setAddressForm" method="post"> 
							<div class="infos">						
								<p>							
									<span class="left"> 
										<b class="red_f mr4_f">*</b>
										<label for="addressPid">所在地：</label>		
										<select id="province" name="province">
                   							<option></option>
                    					</select>
					                    <select id="city" name="city">
					                        <option></option>
					                    </select>
					                    <select id="county" name="county">
					                          <option></option>
					                    </select>
								<script type="text/javascript"  src="__PUBLIC__/index/js/area.js"></script>
								<script type="text/javascript">_init_area();</script>		</span>						
								</p>						
								<p>							
									<b class="red_f mr4_f">*</b>
									<label for="addressStreet">详细地址：</label>							
									<input class="mls-input-text l_ipt_s street" id="addressStreet" type="text" name="street" value=""/>
									
									<strong>&nbsp;</strong>						
								</p>						
								<p>							
									<span class="left">								
										<span>									
											<b class="red_f mr4_f">*</b>
											<label for="addressUser">收件人：</label>									
											<input class="mls-input-text l_ipt reciever" id="addreceiver" type="text" name="receiver" value=""/>
											
											<strong>&nbsp;</strong>								
										</span>						 
									</span>						
								</p>						
								<p>							
									<span class="phone">									
										<b class="red_f mr4_f">*</b>
										<label for="addressPhone">手机号码：</label>									
										<input class="mls-input-text l_ipt contact" id="addressPhone" type="text" name="phone" value=""/>
										
										<strong>&nbsp;</strong>								
									</span>						
								</p>
								<p>							
									<span class="left">									
										<b class="red_f mr4_f">*</b>
										<label for="addressPhone">邮政编码：</label>									
										<input class="mls-input-text l_ipt contact" id="postcode" type="text" name="postcode" value=""/>
										
										<strong>&nbsp;</strong>								
									</span>						
								</p>					
							</div>					
							<div class="buttons">						
								<div class="left_f">							
									<input class="button" type="button" value="保存并使用" id="add_address"/>							
									<input class="cancel" type="button" value="取消" id="add_quxiao" />						
								</div>						
								<span class="set_default_con"> 
									<input class="mls-input-checkbox" type="checkbox" name="is_default" id="is_default" value="" /> 
									<label class="mls-input-label mls-input-checkbox-label" for="is_default">设为默认</label> 	
								</span>					
							</div>	
						</form>

					</div>		
				</div> 
			</div>

			
			<p class="label">选择支付方式</p>	
			<div class="bank">		
				<div class="platform">						
					<div class="list">								
						<div class="b " >					
							<div class="input">			
								<input type="radio" name="pay_id" data-name="货到付款"  value="0" checked="checked" id="pay_id_0" class="mls-input-radio"/>						
								<label for="pay_id_1" class="mls-input-label mls-input-radio-label">					
							</div>
							<div class="image" style="margin-top: 15px">
								<span>货到付款</span>				
							</div>					
						</div>							
						<div class="clear"></div>			
					</div>					
				</div>		
					
				
				
				
			
			<p class="label">商品清单</p>	
			<div class="order">		
				<table cellpadding="0" cellspacing="0">			
					<thead>				
						<tr>					
							<th width="20px" class="first"></th>					
							<th width="390">商品信息</th>					
							<th width="100px">单价（元）</th>					
							<th width="284px">数量</th>					
							<th width="137px">小计（元）</th>					
							<th width="20px" class="last"></th>				
						</tr>			
					</thead> 						
					<tbody class="goods">	
					<volist name="goods_message" id="goods">
						<tr class="first last">
							<td class="first" style="width:40px;">
								</td> 
							<td class="content"> 
								<a class="content-link" target="_blank" href="{:U('detail/index',array('gid'=>$goods['gid']))}"> 
									<img src="__PUBLIC__/{$goods.big_picture}"/> 
									<b><span>{$goods.first_name}</span></b>
									<br><br><br>
									<span class="props">   
									<span>颜色：{$goods.color}</span>    
									<span>尺码：{$goods.size}</span>   
									</span>  
								</a> 
							</td> 
							<td> <div class="u_price">{$goods.price}</div>   </td> 
							<td>{$goods.nums}</td> 
							<td>{$goods.price_all}</td> 
							<td class="last"></td> 
						</tr>
					</volist>
					<input type="hidden" name="nums" value="{$i}">
						<tr class="total">					
							<td class="first"></td>					
							<td colspan="2" class="buyer_msg">						
								<label>购买留言：</label>						
								<textarea name="comment[]" value="" class="mls-input-text comment" id="comment_105043">
								</textarea>					
							</td>					
							<td colspan="2" style="vertical-align:top;">						
								<ul class="coupon_freight">																					
									<li>								
										<!-- <div id="freight_show"class="info freight_show_105043">									<label class="lb">运费：</label>	
											<span class="freight_info">免运费</span>	
										</div> -->								
										<div class="price" style="float: right"><span>
											<if condition="$yunfei eq 0">
												免运费
											<else />
											总运费：{$yunfei}元
											</if>
											</span></div>
									</li>						
								</ul>				 
							</td>					
							<td class="last"></td>				
						</tr>				
						<tr class="total">					
							<td class="first"></td>					
							<td colspan="2"></td>					
							<td colspan="2" class="shop_total">						
								<span>共{$i}件商品，</span>						
								<span>合计：<span id="shop_total_price_105043" class="price">{$count_price}</span>元</span>					
							</td>					
							<td class="last"></td>				
						</tr>			
					</tbody>									
					
					<tfoot>				
						<tr>					
							<td class="first">&nbsp;</td>					
							<td colspan="5" class="last">						
								<span class="right">														
									<span>商品总价：</span>					
									<span class="price">￥<span id="total_price">{$count_price}</span></span>
								
									<a href="javascript:void(0)" class="go_charge" id="charge">
								
									
										<volist name="goods_message" id="goods" key="z">
										<input type="hidden" name="cart_{$z}" value="{$goods.cid}">
										</volist>
										<input type="hidden" name="count_price" value="{$count_price}">
									
								</span>					
							</td>				
						</tr>				 			
					</tfoot>		
				</table>	
			</div>
		</div>
		</form>
		
		
		<script>
			$("#charge").click(function(){
				var check=$("#addr_new").attr('checked');
				if(check=="checked"){
					layer.alert('请选择收货地址！');
					return;
				}
				$("#order_submit").submit();
				
				
				
			});
			
			var count="{$i}";
			for(var i=0;i<=count;i++){
				$("label[for='curernt_address_"+i+"']").click(function(){
					$("#addr_form").css({display:"none"});
				});
			}
			
			
			$("label[for='addr_new'],.adrl_edit").click(function(){
				$("#addr_form").css({display:"block"});
			});
		</script>
		
		

		
<include file="Public/buttom" />
	</body>
</html>
<script type="text/javascript">
	$("#add_address").click(function(){
		var province=$("#province").val();
		var city=$("#city").val();
		var county=$("#county").val();
		var street=$("#addressStreet").val();
		var receiver=$("#addreceiver").val();
		var phone=$("#addressPhone").val();
		var postcode=$("#postcode").val();
		var is_default=$("#is_default").attr('checked');
		if(is_default=="checked"){
			is_default=1;
		}else{
			is_default=0;
		}
		var rege1=/^1[3|4|5|7|8]\d{9}$/;
		var rege2=/^[1-9][0-9]{5}$/;
		if(province=="省份"){
			layer.alert('请选择省份！',{title:"提示"});
			return;
		}
		if(city=="地级市"){
			layer.alert('请选择地级市！',{title:"提示"});
			return;
		}
		if(county=="市、县级市"){
			layer.alert('请选择县级市！',{title:"提示"});
			return;
		}
		if(street==""){
			layer.alert('请输入详细地址！',{title:"提示"});
			return;
		}
		if(receiver==""){
			layer.alert('请输入收件人！',{title:"提示"});
			return;
		}
		if(phone==""){
			layer.alert('请输入手机号码！',{title:"提示"});
			return;
		}
		if(postcode==""){
			layer.alert('请输入邮政编码！',{title:"提示"});
			return;
		}
		if(!rege1.test(phone)){
			layer.alert('手机号码格式不正确！',{title:"提示"});
			return;
		}
		if(!rege2.test(postcode)){
			layer.alert('邮政编码格式不正确！',{title:"提示"});
			return;
		}
		$.ajax({
			url:"{:U('order/addAddress')}",
			type:"post",
			data:{
				province:province,
				city:city,
				county:county,
				street:street,
				receiver:receiver,
				phone:phone,
				postcode:postcode,
				status:is_default
			},
			async:true,
			dataType:"json",
			success:function(data){
				if(data){
					$("#curernt_address_0").attr('value',data['id']);
					$("#curernt_address_0").attr('checked','checked');
					$("#address_0").siblings('div').removeAttr('checked');
					$("#span_0").html(data['address']);
					$("#span_1").html(data['receiver']);
					$("#span_2").html(data['phone']);
					$("#addr_form").css({display:"none"});
					$("#address_0").css('display','block');
					$("#add_new_address").css('display','none');
				}else{
					alert('添加新的收货地址失败！');
				}
			}
		})

	});

	$("#add_quxiao").click(function(){
		$("#addr_form").css('display','none');
		$("#curernt_address_1").attr('checked','checked');
	});
</script>
